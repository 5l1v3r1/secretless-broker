- !user bob

- !user charles

- !host myapp

- !host secretless

- !policy
  id: pg
  body:
  - &pg_variables
    - !variable url
    - !variable username
    - !variable password

  - !layer

  - !webservice

  - !permit
    role: !layer
    privilege: [ read, execute ]
    resources: *pg_variables

  - !grant
    role: !layer
    member: !host /secretless

- !policy
  id: aws
  body:
  - &aws_variables
    - !variable access_key_id
    - !variable secret_access_key
    - !variable region

  - !layer

  - !webservice

  - !permit
    role: !layer
    privilege: [ read, execute ]
    resources: *aws_variables

  - !grant
    role: !layer
    member: !host /secretless

- !permit
  roles:
    - !user bob
    - !host myapp
  privileges: [ execute ]
  resources:
    - !webservice pg
    - !webservice aws
