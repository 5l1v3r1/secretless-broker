providers:
  - name: conjur
    configuration:
      - name: url
        value:
          environment: CONJUR_APPLIANCE_URL
      - name: account
        value:
          environment: CONJUR_ACCOUNT
    credentials:
      - name: username
        value:
          environment: CONJUR_AUTHN_LOGIN
      - name: apiKey
        value:
          environment: CONJUR_AUTHN_API_KEY

listeners:
  - name: http_default
    protocol: http
    address: 0.0.0.0:80

  - name: pg_tcp_default
    protocol: pg
    address: 0.0.0.0:5432

  - name: pg_tcp_5433
    protocol: pg
    address: 0.0.0.0:5433

  - name: pg_tcp_5434
    protocol: pg
    address: 0.0.0.0:5434

  - name: pg_socket_default
    protocol: pg
    socket: ./run/postgresql/.s.PGSQL.5432

handlers:
  - name: aws_via_environment
    type: aws
    listener: http_default
    match:
      - ".*"
    debug: true
    authorization:
      none: true
    credentials:
      - name: access_key_id
        value:
          environment: AWS_ACCESS_KEY_ID
      - name: secret_access_key
        value:
          environment: AWS_SECRET_ACCESS_KEY

  - name: pg_via_socket
    listener: pg_socket_default
    authorization:
      none: true
    debug: true
    credentials:
      - name: address
        value:
          literal: pg:5432
      - name: username
        value:
          literal: conjur
      - name: password
        value:
          literal: conjur

  - name: pg_via_conjur
    listener: pg_tcp_default
    authorization:
      none: true
    debug: true
    credentials:
      - name: address
        value:
          provider: conjur
          id: variable:pg/url
      - name: username
        value:
          provider: conjur
          id: variable:pg/username
      - name: password
        value:
          provider: conjur
          id: variable:pg/password

  - name: pg_via_static
    listener: pg_tcp_5433
    authorization:
      passwords:
        alice: alice
    debug: true
    credentials:
      - name: address
        value:
          literal: pg:5432
      - name: username
        value:
          literal: conjur
      - name: password
        value:
          literal: conjur

  - name: pg_remote_with_conjur_auth
    listener: pg_tcp_5434
    authorization:
      conjur: dev:webservice:pg
    debug: true
    credentials:
      - name: address
        value:
          literal: pg:5432
      - name: username
        value:
          literal: conjur
      - name: password
        value:
          literal: conjur


