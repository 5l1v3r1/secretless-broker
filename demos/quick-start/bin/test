#!/bin/bash
set -e

cleanup () {
  pushd test &>/dev/null
    docker-compose rm -fs
  popd &>/dev/null
}
trap cleanup EXIT ERR

pushd test &>/dev/null
  docker-compose up -d quickstart

  # Quick and dirty check to see if Postgres is running and we can begin testing
  while [[ -z "$(docker-compose logs quickstart | grep 'ready to accept connections')" ]]; do
    sleep 1s
  done

  docker-compose up test-client
popd &>/dev/null